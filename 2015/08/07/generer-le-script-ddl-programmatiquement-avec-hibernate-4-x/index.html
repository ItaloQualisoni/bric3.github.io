<!DOCTYPE html>
<html lang="en">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.69.0" />

    
    
    

<title>Générer le script DDL programmatiquement avec Hibernate 4.x • The Coffee Workshop</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Générer le script DDL programmatiquement avec Hibernate 4.x"/>
<meta name="twitter:description" content="Si par hasard votre base donnée est gérée par un véritable DBA, donc avec des scripts SQL. Mais que vous utilisez hibernate pour mapper les tables avec une configuration non triviale, modules bien découpés, package annotés, etc&hellip;."/>

<meta property="og:title" content="Générer le script DDL programmatiquement avec Hibernate 4.x" />
<meta property="og:description" content="Si par hasard votre base donnée est gérée par un véritable DBA, donc avec des scripts SQL. Mais que vous utilisez hibernate pour mapper les tables avec une configuration non triviale, modules bien découpés, package annotés, etc&hellip;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.arkey.fr/2015/08/07/generer-le-script-ddl-programmatiquement-avec-hibernate-4-x/" />
<meta property="article:published_time" content="2015-08-07T15:26:51+00:00" />
<meta property="article:modified_time" content="2015-08-07T15:26:51+00:00" /><meta property="og:site_name" content="Arkey" />


    






<link rel="stylesheet" href="/scss/hyde-hyde.e8dcd6124217521cb99429500b4fa8392b1f372d14ea1a5a2631f10b3b4652ff.css" integrity="sha256-6NzWEkIXUhy5lClQC0&#43;oOSsfNy0U6hpaJjHxCztGUv8=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    
    <link rel="shortcut icon" sizes="192x192" href="/android-192-favicon.png">

    
    <link rel="shortcut icon" href="/android-192-favicon.png">
    
    


    
</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://blog.arkey.fr">The Coffee Workshop</a>
      </span>
      
      
        <div class="author-image">
          <img src="https://www.gravatar.com/avatar/f31c7fbcbb0766d0632d96fd7e74b649?s=240&d=mp" class="img--circle img--headshot element--center" alt="gravatar">
        </div>
      
      <p class="site__description">
         Java mostly, and general tech 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">The Coffee Workshop</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/"><span class='fa-icon'><i class='fas fa-home'></i></span><code>cd <em>~</em></code>
						<span></span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/posts/"><span class='fa-icon'><i class='fas fa-stream'></i></span><code>ls <em>posts/*</em></code>
						<span></span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/series/"><span class='fa-icon'><i class='fas fa-list-alt'></i></span><code>grep -o <em>series</em> posts/* | sort -u</code>
						<span></span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/tags/"><span class='fa-icon'><i class='fas fa-tags'></i></span><code>grep -o <em>tags</em> posts/* | sort -u</code>
						<span></span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/cool-stuff/"><span class='fa-icon'><i class='fas fa-thumbtack'></i></span><code>cd <em>cool-stuff</em></code>
						<span></span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/whoami/"><span class='fa-icon'><i class='fas fa-id-card'></i></span><code>whoami</code>
						<span></span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/@BriceDutheil" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/bric3" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://speakerdeck.com/bric3" rel="me"><i class="fab fa-speaker-deck" aria-hidden="true"></i></i></a>
	
	
	
	
	
	
	
	<a href="https://linkedin.com/in/dutheilbrice" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://stackoverflow.com/users/48136/brice" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2010 - 2020 Brice Dutheil
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>



  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Générer le script DDL programmatiquement avec Hibernate 4.x</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> 2015-08-07
    
    
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/architecture">architecture</a>
           
      
          <a class="badge badge-tag" href="/tags/code">code</a>
           
      
          <a class="badge badge-tag" href="/tags/tips">tips</a>
           
      
          <a class="badge badge-tag" href="/tags/ddl">ddl</a>
           
      
          <a class="badge badge-tag" href="/tags/hibernate">hibernate</a>
           
      
          <a class="badge badge-tag" href="/tags/java8">java8</a>
           
      
          <a class="badge badge-tag" href="/tags/jpa">jpa</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 2 min read
</div>


  </header>
  
  
  <div class="post">
    <p>Si par hasard votre base donnée est gérée par un véritable DBA, donc avec des scripts SQL. Mais que vous utilisez
hibernate pour mapper les tables avec une configuration non triviale, modules bien découpés, package annotés,
etc&hellip;. Les utilitaires comme <a href="http://juplo.de/hibernate4-maven-plugin/">hibernate4-maven-plugin</a> ne suffisent plus.</p>
<p>Voici un petit exemple code qui utilise le <code>SchemaExporter</code> de hibernate. <em>Le code qui suit est bien sûr à adapter
à la structure du code de l&rsquo;application.</em></p>
<p>Le principe est de passer soit même les classes annotées <strong>et</strong> les package annotés (typiquement par <code>@TypeDef</code>
dans le <code>package-info.java</code>). Pour plus de commodité ce code utilise le framework
<a href="https://github.com/ronmamo/reflections">Reflections</a> pour scanner les classes annotées par les annotations JPA
<code>@Entity</code> et <code>@MappedSuperClass</code>. Par défaut le script génère les <code>drop statements</code>, mais ce comportement peut
se changer à travers les options de <code>SchemaExport</code>.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">javax.persistence.Entity</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">javax.persistence.MappedSuperclass</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.hibernate.cfg.AvailableSettings</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.hibernate.cfg.Configuration</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.hibernate.tool.hbm2ddl.SchemaExport</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.hibernate.tool.hbm2ddl.Target</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.junit.Test</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.reflections.Reflections</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">HibernateDDLGenerator</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> String ENTITIES_PACKAGE <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;com.something&#34;</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> String ANNOTATED_PACKAGE <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;com&#34;</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> String HBM_DIALECT <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;org.hibernate.dialect.Oracle10gDialect&#34;</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#3c5d5d;font-weight:bold">@Test</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">ddl</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> Exception <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">new</span> SchemaExport<span style="color:#000;font-weight:bold">(</span>createHibernateConfig<span style="color:#000;font-weight:bold">())</span>
                <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setOutputFile</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/tmp/ddl.sql&#34;</span><span style="color:#000;font-weight:bold">)</span>
                <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setFormat</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">)</span>
                <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setDelimiter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;;&#34;</span><span style="color:#000;font-weight:bold">)</span>
                <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">create</span><span style="color:#000;font-weight:bold">(</span>Target<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">EXPORT</span><span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">private</span> Configuration <span style="color:#900;font-weight:bold">createHibernateConfig</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
        Configuration conf <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Configuration<span style="color:#000;font-weight:bold">();</span>
        <span style="color:#000;font-weight:bold">final</span> Reflections reflections <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Reflections<span style="color:#000;font-weight:bold">(</span>ENTITIES_PACKAGE<span style="color:#000;font-weight:bold">);</span>
        reflections<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTypesAnnotatedWith</span><span style="color:#000;font-weight:bold">(</span>MappedSuperclass<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">)</span>
                   <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">forEach</span><span style="color:#000;font-weight:bold">(</span>conf<span style="color:#000;font-weight:bold">::</span>addAnnotatedClass<span style="color:#000;font-weight:bold">);</span>
        reflections<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTypesAnnotatedWith</span><span style="color:#000;font-weight:bold">(</span>Entity<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">)</span>
                   <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">forEach</span><span style="color:#000;font-weight:bold">(</span>conf<span style="color:#000;font-weight:bold">::</span>addAnnotatedClass<span style="color:#000;font-weight:bold">);</span>
        conf<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addPackage</span><span style="color:#000;font-weight:bold">(</span>ANNOTATED_PACKAGE<span style="color:#000;font-weight:bold">)</span> <span style="color:#998;font-style:italic">// contains @TypeDefs
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setProperty</span><span style="color:#000;font-weight:bold">(</span>AvailableSettings<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DIALECT</span><span style="color:#000;font-weight:bold">,</span> HBM_DIALECT<span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">return</span> conf<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p><a href="https://gist.github.com/bric3/370654ecad0eb81aca22">Source : gist 370654ecad0eb81aca22</a></p>




  </div>
  

<div class="navigation navigation-single">
    
    <a href="/2012/10/10/note-pour-tard-quand-jvisualvm-ne-marche-pas-sur-sur-osx/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Note pour plus tard: Problème avec jVisualVM sur OSX</span>
    </a>
    
    
    <a href="/2015/11/06/probleme-de-connection-a-oracle/" class="navigation-next">
      <span class="navigation-tittle">Problème de connexion à Oracle</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
        
        
        
        this.page.identifier = 'https://blog.arkey.fr/2015/08/07/generer-le-script-ddl-programmatiquement-avec-hibernate-4-x/';
        this.page.title = 'Générer le script DDL programmatiquement avec Hibernate 4.x';
        this.page.url = 'https://blog.arkey.fr/2015/08/07/generer-le-script-ddl-programmatiquement-avec-hibernate-4-x/';
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "thecoffeeworkshop" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</article>


        </div>
        
    

<script defer src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js" integrity="sha256-KzZiKy0DWYsnwMF+X1DvQngQ2/FxF7MF3Ff72XcpuPs=" crossorigin="anonymous"></script>

    
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
