#!/bin/sh

if [ -f /usr/local/bin/asciidoctor ]; then
  ad="/usr/local/bin/asciidoctor"
else
  ad="/usr/bin/asciidoctor"
fi

$ad --trace --verbose \
  --base-dir=. \
  --require=asciidoctor-diagram \
  --attribute=icons=font \
  --attribute=docinfo=shared \
  --no-header-footer \
  --attribute=nofooter \
  --attribute=sectanchors \
  --attribute=figure-caption! \
  --attribute=source-highlighter=highlightjs \
  --attribute=toc-title! \
  - \
  | sed -E -e "s/img src=\"([^/]+)\"/img src=\"\/diagram\/\1\"/"
  
mkdir -p static/diagram
if ls *.svg >/dev/null 2>&1; then
  mv -f *.svg static/diagram
fi

if ls *.png >/dev/null 2>&1; then
  mv -f *.png static/diagram
fi

