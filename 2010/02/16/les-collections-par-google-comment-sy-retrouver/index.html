<!doctype html><html lang=en><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=cache-control content="public"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.69.0"><title>Les collections par Google, comment s'y retrouver? • The Coffee Workshop</title><meta name=twitter:card content="summary"><meta name=twitter:title content="Les collections par Google, comment s'y retrouver?"><meta name=twitter:description content="Depuis quelques jours déjà le framework de collection par google est sorti en version 1.0. Ce framework a vu le jour chez Google donc, et s’impose finalement comme le prochain framework pour travailler avec les collections."><meta property="og:title" content="Les collections par Google, comment s'y retrouver?"><meta property="og:description" content="Depuis quelques jours déjà le framework de collection par google est sorti en version 1.0. Ce framework a vu le jour chez Google donc, et s’impose finalement comme le prochain framework pour travailler avec les collections."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.arkey.fr/2010/02/16/les-collections-par-google-comment-sy-retrouver/"><meta property="article:published_time" content="2010-02-16T15:51:49+00:00"><meta property="article:modified_time" content="2010-02-16T15:51:49+00:00"><meta property="og:site_name" content="Arkey"><link rel=stylesheet href=/scss/hyde-hyde.9181f25ed2263aeb878ec6f8a84f10c4ebb16150000fca8767308880bdde5ca0.css integrity="sha256-kYHyXtImOuuHjsb4qE8QxOuxYVAAD8qHZzCIgL3eXKA="><link rel=stylesheet href=/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58+TzH3icCkSHGoJ+ed7w=" media=print><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=apple-touch-icon-precomposed sizes=72x72 href=/apple-touch-icon-72-precomposed.png><link rel=apple-touch-icon-precomposed sizes=114x114 href=/apple-touch-icon-114-precomposed.png><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" sizes=192x192 href=/android-192-favicon.png><link rel="shortcut icon" href=/android-192-favicon.png></head><body><div class=sidebar><div class=container><div class=sidebar-about><span class=site__title><a href=https://blog.arkey.fr>The Coffee Workshop</a></span><div class=author-image><img src="https://www.gravatar.com/avatar/f31c7fbcbb0766d0632d96fd7e74b649?s=240&d=mp" class="img--circle img--headshot element--center" alt=gravatar></div><p class=site__description>Java mostly, and general tech</p></div><div class=collapsible-menu><input type=checkbox id=menuToggle>
<label for=menuToggle>The Coffee Workshop</label><div class=menu-content><div><ul class=sidebar-nav><li><a href=/><span class=fa-icon><i class="fas fa-home"></i></span><code>cd <em>~</em></code>
<span></span></a></li><li><a href=/posts/><span class=fa-icon><i class="fas fa-stream"></i></span><code>ls <em>posts/*</em></code>
<span></span></a></li><li><a href=/series/><span class=fa-icon><i class="fas fa-list-alt"></i></span><code>grep -o <em>series</em> posts/* | sort -u</code>
<span></span></a></li><li><a href=/tags/><span class=fa-icon><i class="fas fa-tags"></i></span><code>grep -o <em>tags</em> posts/* | sort -u</code>
<span></span></a></li><li><a href=/cool-stuff/><span class=fa-icon><i class="fas fa-thumbtack"></i></span><code>cd <em>cool-stuff</em></code>
<span></span></a></li><li><a href=/whoami/><span class=fa-icon><i class="fas fa-id-card"></i></span><code>whoami</code>
<span></span></a></li></ul></div><section class=social><a href=https://twitter.com/@BriceDutheil rel=me><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="bird" class="svg-inline--fa fa-bird fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a><a href=https://github.com/bric3 rel=me><i class="fab fa-github fa-lg" aria-hidden=true></i></a><a href=https://speakerdeck.com/bric3 rel=me><i class="fab fa-speaker-deck" aria-hidden=true></i></i></a><a href=https://linkedin.com/in/dutheilbrice rel=me><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="pro-network" class="svg-inline--fa fa-pro-network fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></a><a href=https://stackoverflow.com/users/48136/brice rel=me><i class="fab fa-stack-overflow fa-lg" aria-hidden=true></i></a></section></div></div><div class=copyright>&copy; 2010 - 2020 Brice Dutheil
<a href=https://creativecommons.org/licenses/by-sa/4.0>CC BY-SA 4.0</a></div></div></div><div class="content container"><article><header><h1>Les collections par Google, comment s'y retrouver?</h1><div class=post__meta><i class="fas fa-calendar-alt"></i>2010-02-16<br><i class="fas fa-tags"></i><a class="badge badge-tag" href=/tags/code>code</a>
<a class="badge badge-tag" href=/tags/google-collections>google-collections</a><br><i class="fas fa-clock"></i>5 min read</div></header><div class=post><p>Depuis quelques jours déjà le framework de collection par google est sorti en version 1.0. Ce framework a vu le jour chez Google donc, et s’impose finalement comme le prochain framework pour travailler avec les collections. En effet les classes utilitaires du JDK sont plutôt limitées et les classes commons-collections de Apache ne sont pas <em>générifiés</em>.</p><p>Les classes fournies par Google, ont été tunées pour être performante en rapidité et en utilisation mémoire. Si possible ce sont les collections standard du JDK, les collections du JDK sont mutables. Éventuellement l&rsquo;utilisation des classes standard du JDK pourrait permettre à la JVM de faire les optimisation sur ces objets qu&rsquo;il connait. Également aussi l&rsquo;API orientée builder – un peu comme Joda-Time – facilite l&rsquo;utilisation de google-collections.</p><p>Pour commencer, vous pouvez jeter un œil aux classes suivantes :</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>com<span style=color:#000;font-weight:700>.</span><span style=color:teal>google</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>common</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>collect</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>Collections2</span>
com<span style=color:#000;font-weight:700>.</span><span style=color:teal>google</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>common</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>collect</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>Lists</span>
com<span style=color:#000;font-weight:700>.</span><span style=color:teal>google</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>common</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>collect</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>Maps</span>
com<span style=color:#000;font-weight:700>.</span><span style=color:teal>google</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>common</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>collect</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>Sets</span>
com<span style=color:#000;font-weight:700>.</span><span style=color:teal>google</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>common</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>collect</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>ObjectArrays</span>
com<span style=color:#000;font-weight:700>.</span><span style=color:teal>google</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>common</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>collect</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>Multisets</span>
com<span style=color:#000;font-weight:700>.</span><span style=color:teal>google</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>common</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>collect</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>Multimaps</span>
com<span style=color:#000;font-weight:700>.</span><span style=color:teal>google</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>common</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>collect</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>Iterators</span>
com<span style=color:#000;font-weight:700>.</span><span style=color:teal>google</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>common</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>collect</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>Iterables</span>
</code></pre></div><p>Ces classes utilitaires permettent déjà d’instancier les collections avec quelques commodités, par exemple dans le code ci-dessous les classes retournées sont les <strong>classes mutables du JDK</strong> :</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>LinkedHashSet<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>&gt;</span> linkedHashSet <span style=color:#000;font-weight:700>=</span> Sets<span style=color:#000;font-weight:700>.</span><span style=color:teal>newLinkedHashSet</span><span style=color:#000;font-weight:700>();</span>
ArrayList<span style=color:#000;font-weight:700>&lt;</span>AGenericObject <span style=color:#000;font-weight:700>&lt;</span>Class<span style=color:#000;font-weight:700>&lt;</span>Observer<span style=color:#000;font-weight:700>&gt;&gt;&gt;</span> arrayList <span style=color:#000;font-weight:700>=</span> Lists<span style=color:#000;font-weight:700>.</span><span style=color:teal>newArrayList</span><span style=color:#000;font-weight:700>();</span>
Lists<span style=color:#000;font-weight:700>.</span><span style=color:teal>newArrayList</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;bob&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;marie&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;barack&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;bruce&#34;</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>à la place de :</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>List<span style=color:#000;font-weight:700>&lt;</span>AGenericObject<span style=color:#000;font-weight:700>&lt;</span>Class<span style=color:#000;font-weight:700>&lt;</span>Observer<span style=color:#000;font-weight:700>&gt;&gt;&gt;</span> list <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> ArrayList<span style=color:#000;font-weight:700>&lt;</span>AGenericObject<span style=color:#000;font-weight:700>&lt;</span>Class<span style=color:#000;font-weight:700>&lt;</span>Observer<span style=color:#000;font-weight:700>&gt;&gt;&gt;();</span>
</code></pre></div><p>Voilà rapidement pour les utilitaires des collections fournies par le JDK, mais Google fournit également des <strong>implémentations immutables</strong> des collections :</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>ImmutableSet<span style=color:#000;font-weight:700>&lt;</span>integer<span style=color:#000;font-weight:700>&gt;</span> immutableSet <span style=color:#000;font-weight:700>=</span> ImmutableSet<span style=color:#000;font-weight:700>.</span><span style=color:teal>of</span><span style=color:#000;font-weight:700>(</span>1<span style=color:#000;font-weight:700>,</span> 2<span style=color:#000;font-weight:700>,</span> 3<span style=color:#000;font-weight:700>,</span> 4<span style=color:#000;font-weight:700>,</span> 5<span style=color:#000;font-weight:700>);</span>
ImmutableList<span style=color:#000;font-weight:700>&lt;</span>string<span style=color:#000;font-weight:700>&gt;</span> immutableList <span style=color:#000;font-weight:700>=</span> ImmutableList<span style=color:#000;font-weight:700>.</span><span style=color:teal>of</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;a,b,c,d,e,f,g&#34;</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>split</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;,&#34;</span><span style=color:#000;font-weight:700>));</span>
</code></pre></div><p>Pour les maps, il y a aussi une API plutôt expressive et facilement utilisable. Par exemple pour créer facilement une multimap:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>Multimap<span style=color:#000;font-weight:700>&lt;</span>color <span style=color:#000;font-weight:700>,</span> Fruit<span style=color:#000;font-weight:700>&gt;</span> colorIndex <span style=color:#000;font-weight:700>=</span> HashMultimap<span style=color:#000;font-weight:700>.</span><span style=color:teal>create</span><span style=color:#000;font-weight:700>();</span>
<span style=color:#000;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span>Fruit fruit <span style=color:#000;font-weight:700>:</span> fruits<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
    colorIndex<span style=color:#000;font-weight:700>.</span><span style=color:teal>put</span><span style=color:#000;font-weight:700>(</span>fruit<span style=color:#000;font-weight:700>.</span><span style=color:teal>getColor</span><span style=color:#000;font-weight:700>(),</span> fruit<span style=color:#000;font-weight:700>);</span>
<span style=color:#000;font-weight:700>}</span>
Collection<span style=color:#000;font-weight:700>&lt;</span>Fruit<span style=color:#000;font-weight:700>&gt;</span> redFruits <span style=color:#000;font-weight:700>=</span> colorIndex<span style=color:#000;font-weight:700>.</span><span style=color:teal>get</span><span style=color:#000;font-weight:700>(</span>Color<span style=color:#000;font-weight:700>.</span><span style=color:teal>RED</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Si on veut jouer avec des map bi-directionnelles.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>ImmutableBiMap<span style=color:#000;font-weight:700>&lt;</span>Integer <span style=color:#000;font-weight:700>,</span> String<span style=color:#000;font-weight:700>&gt;</span> biMap <span style=color:#000;font-weight:700>=</span> ImmutableBiMap<span style=color:#000;font-weight:700>.</span><span style=color:teal>of</span><span style=color:#000;font-weight:700>(</span>0<span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;Zero&#34;</span><span style=color:#000;font-weight:700>,</span> 1<span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;One&#34;</span><span style=color:#000;font-weight:700>,</span> 2<span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;Two&#34;</span><span style=color:#000;font-weight:700>,</span> 3<span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;Three&#34;</span><span style=color:#000;font-weight:700>);</span>
biMap<span style=color:#000;font-weight:700>.</span><span style=color:teal>inverse</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Zero&#34;</span><span style=color:#000;font-weight:700>);</span> <span style=color:#998;font-style:italic>// =&gt; 0
</span></code></pre></div><p>L’outil MapMaker pour créer des maps customisées :</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>Map<span style=color:#000;font-weight:700>&lt;</span>Params <span style=color:#000;font-weight:700>,</span> Result<span style=color:#000;font-weight:700>&gt;</span> resultCache <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> MapMaker<span style=color:#000;font-weight:700>().</span><span style=color:teal>expiration</span><span style=color:#000;font-weight:700>(</span>5 <span style=color:#000;font-weight:700>*</span> 60<span style=color:#000;font-weight:700>,</span>TimeUnit<span style=color:#000;font-weight:700>.</span><span style=color:teal>SECONDS</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>.</span><span style=color:teal>makeComputingMap</span><span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>new</span> Function<span style=color:#000;font-weight:700>&lt;</span>Params <span style=color:#000;font-weight:700>,</span> Result<span style=color:#000;font-weight:700>&gt;()</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>public</span> Result <span style=color:#900;font-weight:700>apply</span><span style=color:#000;font-weight:700>(</span>Params param<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#000;font-weight:700>return</span> computeHeavyAlgorythm<span style=color:#000;font-weight:700>();</span>
        <span style=color:#000;font-weight:700>}</span>
    <span style=color:#000;font-weight:700>}).</span><span style=color:teal>makeMap</span><span style=color:#000;font-weight:700>();</span>
</code></pre></div><p>Il est aussi possible de ne pas utiliser l’expiration mais de choisir plutôt des WeakReference ou des SoftReference pour les clés et/ou les valeurs.</p><p>Comment utiliser les Multiset. A noter, le Multiset ci-dessous est mutable! Pur un MultiSet immutable il faut le créer avec ImmutableMultiset.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>Multiset<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>&gt;</span> histogram <span style=color:#000;font-weight:700>=</span> HashMultiset<span style=color:#000;font-weight:700>.</span><span style=color:teal>create</span><span style=color:#000;font-weight:700>();</span>
histogram<span style=color:#000;font-weight:700>.</span><span style=color:teal>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Hello&#34;</span><span style=color:#000;font-weight:700>);</span>
histogram<span style=color:#000;font-weight:700>.</span><span style=color:teal>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;World&#34;</span><span style=color:#000;font-weight:700>,</span> 3<span style=color:#000;font-weight:700>);</span>
histogram<span style=color:#000;font-weight:700>.</span><span style=color:teal>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Hello&#34;</span><span style=color:#000;font-weight:700>);</span>
histogram<span style=color:#000;font-weight:700>.</span><span style=color:teal>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;!&#34;</span><span style=color:#000;font-weight:700>);</span>

<span style=color:#458;font-weight:700>int</span> count<span style=color:#000;font-weight:700>;</span>
count <span style=color:#000;font-weight:700>=</span> histogram<span style=color:#000;font-weight:700>.</span><span style=color:teal>count</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Hello&#34;</span><span style=color:#000;font-weight:700>);</span>    <span style=color:#998;font-style:italic>// 2
</span><span style=color:#998;font-style:italic></span>count <span style=color:#000;font-weight:700>=</span> histogram<span style=color:#000;font-weight:700>.</span><span style=color:teal>count</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;World&#34;</span><span style=color:#000;font-weight:700>);</span>    <span style=color:#998;font-style:italic>// 3
</span><span style=color:#998;font-style:italic></span>count <span style=color:#000;font-weight:700>=</span> histogram<span style=color:#000;font-weight:700>.</span><span style=color:teal>count</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Brice&#34;</span><span style=color:#000;font-weight:700>);</span>    <span style=color:#998;font-style:italic>// 0
</span></code></pre></div><p>Et pour les itérateurs :</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>UnmodifiableIterator<span style=color:#000;font-weight:700>&lt;</span>Object<span style=color:#000;font-weight:700>&gt;</span> tokenizerIt <span style=color:#000;font-weight:700>=</span> Iterators<span style=color:#000;font-weight:700>.</span><span style=color:teal>forEnumeration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>new</span> StringTokenizer<span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;a|b|c|d|e&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;|&#34;</span><span style=color:#000;font-weight:700>));</span> <span style=color:#998;font-style:italic>// Eh oui ! StringTokenizer implémente Enumeration&lt;Object&gt;
</span><span style=color:#998;font-style:italic></span>
UnmodifiableIterator<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>&gt;</span> splitIt <span style=color:#000;font-weight:700>=</span> Iterators<span style=color:#000;font-weight:700>.</span><span style=color:teal>forArray</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;e|ed|f|g|h|i&#34;</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>split</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;|&#34;</span><span style=color:#000;font-weight:700>));</span>

Iterator<span style=color:#000;font-weight:700>&lt;</span>object<span style=color:#000;font-weight:700>&gt;</span> concatenatedIt <span style=color:#000;font-weight:700>=</span> Iterators<span style=color:#000;font-weight:700>.</span><span style=color:teal>concat</span><span style=color:#000;font-weight:700>(</span>tokenizerIt<span style=color:#000;font-weight:700>,</span> splitIt<span style=color:#000;font-weight:700>);</span>

Iterators<span style=color:#000;font-weight:700>.</span><span style=color:teal>frequency</span><span style=color:#000;font-weight:700>(</span>concatenatedIt<span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;e&#34;</span><span style=color:#000;font-weight:700>);</span> <span style=color:#998;font-style:italic>// 2
</span><span style=color:#998;font-style:italic></span>concatenatedIt<span style=color:#000;font-weight:700>.</span><span style=color:teal>hasNext</span><span style=color:#000;font-weight:700>();</span> <span style=color:#998;font-style:italic>// false
</span></code></pre></div><p>Ok maintenant que nous avons vu comment créer des collections, on peut regarder comment vraiment jouer avec. Ordonner une collection par exemple; il faut utiliser la classe Ordering (étends l’interface Comparator de java)</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>Function<span style=color:#000;font-weight:700>&lt;</span>Fruit<span style=color:#000;font-weight:700>,</span> Color<span style=color:#000;font-weight:700>&gt;</span> getColorFunction <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> Function<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000;font-weight:700>public</span> Color <span style=color:#900;font-weight:700>apply</span><span style=color:#000;font-weight:700>(</span>Fruit from<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>return</span> from<span style=color:#000;font-weight:700>.</span><span style=color:teal>getColor</span><span style=color:#000;font-weight:700>();</span>
    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>};</span>

Function<span style=color:#000;font-weight:700>&lt;</span>Fruit <span style=color:#000;font-weight:700>,</span> String<span style=color:#000;font-weight:700>&gt;</span> getNameFunction <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> Function<span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000;font-weight:700>public</span> String <span style=color:#900;font-weight:700>apply</span><span style=color:#000;font-weight:700>(</span>Fruit from<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>return</span> from<span style=color:#000;font-weight:700>.</span><span style=color:teal>getName</span><span style=color:#000;font-weight:700>();</span>
    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>};</span>

Ordering<span style=color:#000;font-weight:700>&lt;</span>Fruit<span style=color:#000;font-weight:700>&gt;</span> colorOrdering <span style=color:#000;font-weight:700>=</span> Ordering<span style=color:#000;font-weight:700>.</span><span style=color:teal>natural</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>onResultOf</span><span style=color:#000;font-weight:700>(</span>getColorFunction<span style=color:#000;font-weight:700>);</span>
Ordering<span style=color:#000;font-weight:700>&lt;</span>Fruit<span style=color:#000;font-weight:700>&gt;</span> nameOrdering <span style=color:#000;font-weight:700>=</span> Ordering<span style=color:#000;font-weight:700>.</span><span style=color:teal>natural</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>onResultOf</span><span style=color:#000;font-weight:700>(</span>getNameFunction<span style=color:#000;font-weight:700>);</span>

<span style=color:#998;font-style:italic>// ordonner par couleur puis par nom
</span><span style=color:#998;font-style:italic></span>Ordering<span style=color:#000;font-weight:700>&lt;</span>Fruit<span style=color:#000;font-weight:700>&gt;</span> colorAndNameOrdering <span style=color:#000;font-weight:700>=</span> colorOrdering<span style=color:#000;font-weight:700>.</span><span style=color:teal>compound</span><span style=color:#000;font-weight:700>(</span>nameOrdering<span style=color:#000;font-weight:700>);</span>

List<span style=color:#000;font-weight:700>&lt;</span>Fruit<span style=color:#000;font-weight:700>&gt;</span> sortedFruitList <span style=color:#000;font-weight:700>=</span> Ordering<span style=color:#000;font-weight:700>.</span><span style=color:teal>natural</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>sortedCopy</span><span style=color:#000;font-weight:700>(</span>fruits<span style=color:#000;font-weight:700>);</span>
Set<span style=color:#000;font-weight:700>&lt;</span>Fruit<span style=color:#000;font-weight:700>&gt;</span> sortedFruits <span style=color:#000;font-weight:700>=</span> ImmutableSortedSet<span style=color:#000;font-weight:700>.</span><span style=color:teal>orderedBy</span><span style=color:#000;font-weight:700>(</span>colorAndNameOrdering<span style=color:#000;font-weight:700>).</span><span style=color:teal>addAll</span><span style=color:#000;font-weight:700>(</span>fruits<span style=color:#000;font-weight:700>).</span><span style=color:teal>build</span><span style=color:#000;font-weight:700>();</span>
</code></pre></div><p>Filtrer des éléments est devenu super facile à utiliser. Il nous faut les classes Predicate et Predicates.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>List<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>&gt;</span> names <span style=color:#000;font-weight:700>=</span> Lists<span style=color:#000;font-weight:700>.</span><span style=color:teal>asList</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Clément&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;Jean-Max&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;Caroline&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;Céline&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;Brice&#34;</span><span style=color:#000;font-weight:700>);</span>
Iterable<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>&gt;</span> filtered <span style=color:#000;font-weight:700>=</span> Iterables<span style=color:#000;font-weight:700>.</span><span style=color:teal>filter</span><span style=color:#000;font-weight:700>(</span>
    names<span style=color:#000;font-weight:700>,</span>
    Predicates<span style=color:#000;font-weight:700>.</span><span style=color:teal>or</span><span style=color:#000;font-weight:700>(</span>
        Predicates<span style=color:#000;font-weight:700>.</span><span style=color:teal>or</span><span style=color:#000;font-weight:700>(</span>Predicates<span style=color:#000;font-weight:700>.</span><span style=color:teal>equalTo</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Clément&#34;</span><span style=color:#000;font-weight:700>),</span> Predicates<span style=color:#000;font-weight:700>.</span><span style=color:teal>equalTo</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Brice&#34;</span><span style=color:#000;font-weight:700>)),</span>
        returnALengthPredicate<span style=color:#000;font-weight:700>(</span>5<span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Il est possible de faire des transformations</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>Lists<span style=color:#000;font-weight:700>.</span><span style=color:teal>transform</span><span style=color:#000;font-weight:700>(</span>lotoNumbers<span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>new</span> Function<span style=color:#000;font-weight:700>&lt;</span>String <span style=color:#000;font-weight:700>,</span> Integer<span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000;font-weight:700>public</span> Integer <span style=color:#900;font-weight:700>apply</span><span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>final</span> String from<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>return</span> Integer<span style=color:#000;font-weight:700>.</span><span style=color:teal>valueOf</span><span style=color:#000;font-weight:700>(</span>from<span style=color:#000;font-weight:700>);</span>
    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>});</span>
</code></pre></div><p>Que peut-on faire d’autre? Par exemple avec les maps et les sets, on peut observer les différences, faire des unions, ou faire des intersections.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>MapDifference<span style=color:#000;font-weight:700>&lt;</span>String <span style=color:#000;font-weight:700>,</span> Integer<span style=color:#000;font-weight:700>&gt;</span> differenceMap <span style=color:#000;font-weight:700>=</span> Maps<span style=color:#000;font-weight:700>.</span><span style=color:teal>difference</span><span style=color:#000;font-weight:700>(</span>mapA<span style=color:#000;font-weight:700>,</span> mapB<span style=color:#000;font-weight:700>);</span>
differenceMap<span style=color:#000;font-weight:700>.</span><span style=color:teal>areEqual</span><span style=color:#000;font-weight:700>();</span>
Map<span style=color:#000;font-weight:700>&lt;</span>String <span style=color:#000;font-weight:700>,</span> ValueDifference<span style=color:#000;font-weight:700>&lt;</span>Integer<span style=color:#000;font-weight:700>&gt;&gt;</span> entriesDiffering <span style=color:#000;font-weight:700>=</span> differenceMap<span style=color:#000;font-weight:700>.</span><span style=color:teal>entriesDiffering</span><span style=color:#000;font-weight:700>();</span>
Map<span style=color:#000;font-weight:700>&lt;</span>String <span style=color:#000;font-weight:700>,</span> Integer<span style=color:#000;font-weight:700>&gt;</span> entriesOnlyOnLeft <span style=color:#000;font-weight:700>=</span> differenceMap<span style=color:#000;font-weight:700>.</span><span style=color:teal>entriesOnlyOnLeft</span><span style=color:#000;font-weight:700>();</span>
Map<span style=color:#000;font-weight:700>&lt;</span>String <span style=color:#000;font-weight:700>,</span> Integer<span style=color:#000;font-weight:700>&gt;</span> entriesOnlyOnRight <span style=color:#000;font-weight:700>=</span> differenceMap<span style=color:#000;font-weight:700>.</span><span style=color:teal>entriesOnlyOnRight</span><span style=color:#000;font-weight:700>();</span>
Map<span style=color:#000;font-weight:700>&lt;</span>String <span style=color:#000;font-weight:700>,</span> Integer<span style=color:#000;font-weight:700>&gt;</span> entriesInCommon <span style=color:#000;font-weight:700>=</span> differenceMap<span style=color:#000;font-weight:700>.</span><span style=color:teal>entriesInCommon</span><span style=color:#000;font-weight:700>();</span>
</code></pre></div><p>On peut également faire de l’indexation sur des listes de map :</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>List<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>&gt;</span> badGuys <span style=color:#000;font-weight:700>=</span> Arrays<span style=color:#000;font-weight:700>.</span><span style=color:teal>asList</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;Inky&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;Scratchy&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;Blinky&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;Pinky&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;Pinky&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;Clyde&#34;</span><span style=color:#000;font-weight:700>);</span>
Function<span style=color:#000;font-weight:700>&lt;</span>String <span style=color:#000;font-weight:700>,</span> Integer<span style=color:#000;font-weight:700>&gt;</span> stringLengthFunction <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>...;</span>

Multimap<span style=color:#000;font-weight:700>&lt;</span>String <span style=color:#000;font-weight:700>,</span> Integer<span style=color:#000;font-weight:700>&gt;</span> index <span style=color:#000;font-weight:700>=</span> Multimaps<span style=color:#000;font-weight:700>.</span><span style=color:teal>index</span><span style=color:#000;font-weight:700>(</span>badGuys<span style=color:#000;font-weight:700>,</span> stringLengthFunction<span style=color:#000;font-weight:700>);</span> <span style=color:#998;font-style:italic>// { 4=[Inky], 5=[Pinky, Pinky, Clyde], 6=[Blinky], 7=[Scratchy] }
</span></code></pre></div><p>Au cas ou pour éviter de chercher voici quelques méthodes utilitaires dans Iterables, d&rsquo;ailleurs c&rsquo;est là qu&rsquo;on retrouve le fameux isEmpty. (Attention la librairie google ne vérifie pas la nullité, et leur argument est de ne pas encourager de retourner null mais plutôt des collections vide, bref ce que dit Joshua Blosh dans son fameux livre Effective Java, §Item 43)</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>Iterables<span style=color:#000;font-weight:700>.</span><span style=color:teal>getOnlyElement</span><span style=color:#000;font-weight:700>(</span>ImmutableSet<span style=color:#000;font-weight:700>.</span><span style=color:teal>of</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;1&#34;</span><span style=color:#000;font-weight:700>));</span> <span style=color:#998;font-style:italic>// 0
</span><span style=color:#998;font-style:italic></span>Iterables<span style=color:#000;font-weight:700>.</span><span style=color:teal>getOnlyElement</span><span style=color:#000;font-weight:700>(</span>ImmutableSet<span style=color:#000;font-weight:700>.</span><span style=color:teal>of</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;2&#34;</span><span style=color:#000;font-weight:700>));</span> <span style=color:#998;font-style:italic>// IllegalArgumentException
</span><span style=color:#998;font-style:italic></span>
Iterables<span style=color:#000;font-weight:700>.</span><span style=color:teal>isEmpty</span><span style=color:#000;font-weight:700>(</span>ImmutableMultiset<span style=color:#000;font-weight:700>.</span><span style=color:teal>of</span><span style=color:#000;font-weight:700>());</span> <span style=color:#998;font-style:italic>// true
</span><span style=color:#998;font-style:italic></span>Iterables<span style=color:#000;font-weight:700>.</span><span style=color:teal>isEmpty</span><span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>null</span><span style=color:#000;font-weight:700>);</span> <span style=color:#998;font-style:italic>// NullPointerException
</span><span style=color:#998;font-style:italic></span>Iterable<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>&gt;</span> moreFruits <span style=color:#000;font-weight:700>=</span> Iterables<span style=color:#000;font-weight:700>.</span><span style=color:teal>concat</span><span style=color:#000;font-weight:700>(</span>ImmutableMultiset<span style=color:#000;font-weight:700>.</span><span style=color:teal>of</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;apple&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;banana&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;kiwi&#34;</span><span style=color:#000;font-weight:700>),</span> Lists<span style=color:#000;font-weight:700>.</span><span style=color:teal>newArrayList</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;ananas&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;orange&#34;</span><span style=color:#000;font-weight:700>));</span> <span style=color:#998;font-style:italic>// &#34;apple&#34;, &#34;banana&#34;, &#34;kiwi&#34;, &#34;ananas&#34;, &#34;orange&#34;
</span><span style=color:#998;font-style:italic></span>String kiwi <span style=color:#000;font-weight:700>=</span> Iterables<span style=color:#000;font-weight:700>.</span><span style=color:teal>getLast</span><span style=color:#000;font-weight:700>(</span>ImmutableMultiset<span style=color:#000;font-weight:700>.</span><span style=color:teal>of</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;apple&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;banana&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;kiwi&#34;</span><span style=color:#000;font-weight:700>));</span> <span style=color:#998;font-style:italic>// &#34;kiwi&#34;
</span><span style=color:#998;font-style:italic></span>
Iterable<span style=color:#000;font-weight:700>&lt;</span>List <span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>&gt;&gt;</span> fruitBasket <span style=color:#000;font-weight:700>=</span> Iterables<span style=color:#000;font-weight:700>.</span><span style=color:teal>partition</span><span style=color:#000;font-weight:700>(</span>moreFruits<span style=color:#000;font-weight:700>,</span> 2<span style=color:#000;font-weight:700>);</span>  <span style=color:#998;font-style:italic>// { &#34;apple&#34;, &#34;banana&#34; }, { &#34;kiwi&#34;, &#34;ananas&#34; }, { &#34;orange&#34; }
</span></code></pre></div><p>Pour passer d’un Iterable à un tableau :</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>Iterables<span style=color:#000;font-weight:700>.</span><span style=color:teal>toArray</span><span style=color:#000;font-weight:700>(</span>Lists<span style=color:#000;font-weight:700>.</span><span style=color:teal>newArrayList</span><span style=color:#000;font-weight:700>(</span><span style=color:#000;font-weight:700>new</span> DateTime<span style=color:#000;font-weight:700>(),</span> <span style=color:#000;font-weight:700>new</span> DateTime<span style=color:#000;font-weight:700>().</span><span style=color:teal>plusDays</span><span style=color:#000;font-weight:700>(</span>1<span style=color:#000;font-weight:700>)),</span> DateTime<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Voilà il y a pas mal de petits trucs bien sympa, ceci dit il peut manquer des choses qui nous semblent essentielles. Mais cette bibliothèque apporte enfin des choses qui nous simplifient la vie. Les commons-collection ont bien marqués nos habitudes, mais pour s’y retrouver et utiliser cette bibliothèque à bon escient il est certain qu&rsquo;il va falloir faire un petit effort.</p></div><div class="navigation navigation-single"><a href=/2010/02/12/une-fuite-memoire-beaucoup-de-reflection-et-pas-de-outofmemoryerror/ class=navigation-prev><i aria-hidden=true class="fa fa-chevron-left"></i><span class=navigation-tittle>Une fuite mémoire, beaucoup de reflection et pas de OutOfMemoryError</span></a>
<a href=/2010/03/09/mockito-1-8-3/ class=navigation-next><span class=navigation-tittle>Mockito 1.8.3</span>
<i aria-hidden=true class="fa fa-chevron-right"></i></a></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){this.page.identifier='https://blog.arkey.fr/2010/02/16/les-collections-par-google-comment-sy-retrouver/';this.page.title='Les collections par Google, comment s\x27y retrouver?';this.page.url='https://blog.arkey.fr/2010/02/16/les-collections-par-google-comment-sy-retrouver/';};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"thecoffeeworkshop"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></div><script defer src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js integrity="sha256-KzZiKy0DWYsnwMF+X1DvQngQ2/FxF7MF3Ff72XcpuPs=" crossorigin=anonymous></script><script type=text/javascript>hljs.initHighlightingOnLoad();</script></body></html>