<!doctype html><html lang=en><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=cache-control content="public"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.69.0"><title>Mockito 1.8.3 • The Coffee Workshop</title><meta name=twitter:card content="summary"><meta name=twitter:title content="Mockito 1.8.3"><meta name=twitter:description content="Le voilà il est sorti. Ce framework de mock digne épigone de easymock, a su plaire et propose plus que son ancêtre. Mais quoi de neuf qui vaut la peine d'être mentionné?"><meta property="og:title" content="Mockito 1.8.3"><meta property="og:description" content="Le voilà il est sorti. Ce framework de mock digne épigone de easymock, a su plaire et propose plus que son ancêtre. Mais quoi de neuf qui vaut la peine d'être mentionné?"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.arkey.fr/2010/03/09/mockito-1-8-3/"><meta property="article:published_time" content="2010-03-09T21:41:20+00:00"><meta property="article:modified_time" content="2010-03-09T21:41:20+00:00"><meta property="og:site_name" content="Arkey"><link rel=stylesheet href=/scss/hyde-hyde.9181f25ed2263aeb878ec6f8a84f10c4ebb16150000fca8767308880bdde5ca0.css integrity="sha256-kYHyXtImOuuHjsb4qE8QxOuxYVAAD8qHZzCIgL3eXKA="><link rel=stylesheet href=/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58+TzH3icCkSHGoJ+ed7w=" media=print><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=apple-touch-icon-precomposed sizes=72x72 href=/apple-touch-icon-72-precomposed.png><link rel=apple-touch-icon-precomposed sizes=114x114 href=/apple-touch-icon-114-precomposed.png><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" sizes=192x192 href=/android-192-favicon.png><link rel="shortcut icon" href=/android-192-favicon.png></head><body><div class=sidebar><div class=container><div class=sidebar-about><span class=site__title><a href=https://blog.arkey.fr>The Coffee Workshop</a></span><div class=author-image><img src="https://www.gravatar.com/avatar/f31c7fbcbb0766d0632d96fd7e74b649?s=240&d=mp" class="img--circle img--headshot element--center" alt=gravatar></div><p class=site__description>Java mostly, and general tech</p></div><div class=collapsible-menu><input type=checkbox id=menuToggle>
<label for=menuToggle>The Coffee Workshop</label><div class=menu-content><div><ul class=sidebar-nav><li><a href=/><span class=fa-icon><i class="fas fa-home"></i></span><code>cd <em>~</em></code>
<span></span></a></li><li><a href=/posts/><span class=fa-icon><i class="fas fa-stream"></i></span><code>ls <em>posts/*</em></code>
<span></span></a></li><li><a href=/series/><span class=fa-icon><i class="fas fa-list-alt"></i></span><code>grep -o <em>series</em> posts/* | sort -u</code>
<span></span></a></li><li><a href=/tags/><span class=fa-icon><i class="fas fa-tags"></i></span><code>grep -o <em>tags</em> posts/* | sort -u</code>
<span></span></a></li><li><a href=/cool-stuff/><span class=fa-icon><i class="fas fa-thumbtack"></i></span><code>cd <em>cool-stuff</em></code>
<span></span></a></li><li><a href=/whoami/><span class=fa-icon><i class="fas fa-id-card"></i></span><code>whoami</code>
<span></span></a></li></ul></div><section class=social><a href=https://twitter.com/@BriceDutheil rel=me><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="bird" class="svg-inline--fa fa-bird fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a><a href=https://github.com/bric3 rel=me><i class="fab fa-github fa-lg" aria-hidden=true></i></a><a href=https://speakerdeck.com/bric3 rel=me><i class="fab fa-speaker-deck" aria-hidden=true></i></i></a><a href=https://linkedin.com/in/dutheilbrice rel=me><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="pro-network" class="svg-inline--fa fa-pro-network fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></a><a href=https://stackoverflow.com/users/48136/brice rel=me><i class="fab fa-stack-overflow fa-lg" aria-hidden=true></i></a></section></div></div><div class=copyright>&copy; 2010 - 2020 Brice Dutheil
<a href=https://creativecommons.org/licenses/by-sa/4.0>CC BY-SA 4.0</a></div></div></div><div class="content container"><article><header><h1>Mockito 1.8.3</h1><div class=post__meta><i class="fas fa-calendar-alt"></i>2010-03-09<br><i class="fas fa-tags"></i><a class="badge badge-tag" href=/tags/code>code</a>
<a class="badge badge-tag" href=/tags/agile>agile</a>
<a class="badge badge-tag" href=/tags/agilite>agilité</a>
<a class="badge badge-tag" href=/tags/mockito>mockito</a>
<a class="badge badge-tag" href=/tags/tdd>tdd</a><br><i class="fas fa-clock"></i>4 min read</div></header><div class=post><p>Le voilà il est sorti. Ce framework de mock digne épigone de easymock, a su plaire et propose plus que son ancêtre. Mais quoi de neuf qui vaut la peine d'être mentionné?!</p><h2 id=extensions-des-annotations>Extensions des annotations</h2><p>Le code ci-dessous présente le support étendu des annotations.</p><ul><li><code>@InjectMock</code>, qui permet donc d&rsquo;injecter les bouchons et les espions dans l&rsquo;instance de ce champs. Il s&rsquo;agit le plus souvent de classe testée. Attention la classe instanciée ne doit pas être nulle.</li><li><code>@Mock</code> a été étendu pour fournir des paramètres, équivalent aux possibilités offertes par <code>withSettings()</code>, par exemple :</li></ul><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>Mockito<span style=color:#000;font-weight:700>.</span><span style=color:teal>mock</span><span style=color:#000;font-weight:700>(</span>Class<span style=color:#000;font-weight:700>&lt;</span> <span style=color:#000;font-weight:700>?&gt;,</span> Mockito<span style=color:#000;font-weight:700>.</span><span style=color:teal>withSettings</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>name</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;a mock for bob&#34;</span><span style=color:#000;font-weight:700>));</span>
</code></pre></div><ul><li><code>@Spy</code> qui comme son nom l&rsquo;indique permet de créer un espion à partir d&rsquo;une instance déjà créé.</li><li><code>@Captor</code> qui permet d&rsquo;instancier un <code>ArgumentCaptor</code>.</li></ul><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#000;font-weight:700>import</span> <span style=color:#555>org.junit.Test</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>import</span> <span style=color:#555>org.junit.runner.RunWith</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>import</span> <span style=color:#555>org.mockito.*</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>import</span> <span style=color:#555>org.mockito.runners.MockitoJUnitRunner</span><span style=color:#000;font-weight:700>;</span>

<span style=color:#000;font-weight:700>import</span> <span style=color:#555>java.lang.reflect.Method</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>import</span> <span style=color:#555>java.util.HashMap</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>import</span> <span style=color:#555>java.util.List</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>import</span> <span style=color:#555>java.util.Map</span><span style=color:#000;font-weight:700>;</span>

<span style=color:#000;font-weight:700>import static</span> <span style=color:#555>org.junit.Assert.assertSame</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>import static</span> <span style=color:#555>org.mockito.BDDMockito.given</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>import static</span> <span style=color:#555>org.mockito.Mockito.verify</span><span style=color:#000;font-weight:700>;</span>

<span style=color:#3c5d5d;font-weight:700>@RunWith</span><span style=color:#000;font-weight:700>(</span>MockitoJUnitRunner<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>BusinessTestStuff</span> <span style=color:#000;font-weight:700>{</span>

  <span style=color:#3c5d5d;font-weight:700>@InjectMocks</span>
  <span style=color:#000;font-weight:700>private</span> BusinessStuff stuffToTest <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> BusinessStuff<span style=color:#000;font-weight:700>();</span>

  <span style=color:#3c5d5d;font-weight:700>@Mock</span><span style=color:#000;font-weight:700>(</span>name <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;businessMethods&#34;</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000;font-weight:700>private</span> List<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>&gt;</span> methodList<span style=color:#000;font-weight:700>;</span>

  <span style=color:#3c5d5d;font-weight:700>@Mock</span><span style=color:#000;font-weight:700>(</span>name <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;technicalMethods&#34;</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000;font-weight:700>private</span> List<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>&gt;</span> methodList2<span style=color:#000;font-weight:700>;</span>

  <span style=color:#3c5d5d;font-weight:700>@Spy</span>
  <span style=color:#000;font-weight:700>private</span> Map<span style=color:#000;font-weight:700>&lt;</span>Class <span style=color:#000;font-weight:700>&lt;?&gt;,</span> Object<span style=color:#000;font-weight:700>&gt;</span> classInstances <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>new</span> HashMap<span style=color:#000;font-weight:700>&lt;</span>Class <span style=color:#000;font-weight:700>&lt;?&gt;,</span> Object<span style=color:#000;font-weight:700>&gt;();</span>

  <span style=color:#3c5d5d;font-weight:700>@Captor</span>
  <span style=color:#000;font-weight:700>private</span> ArgumentCaptor<span style=color:#000;font-weight:700>&lt;</span>String<span style=color:#000;font-weight:700>&gt;</span> methodCaptor<span style=color:#000;font-weight:700>;</span>

  <span style=color:#3c5d5d;font-weight:700>@Test</span>
  <span style=color:#000;font-weight:700>public</span> <span style=color:#458;font-weight:700>void</span> <span style=color:#900;font-weight:700>shouldDoSomethingWithBusinessAndTechnicalMethod</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#998;font-style:italic>// given
</span><span style=color:#998;font-style:italic></span>    given<span style=color:#000;font-weight:700>(</span>methodList<span style=color:#000;font-weight:700>.</span><span style=color:teal>get</span><span style=color:#000;font-weight:700>(</span>15<span style=color:#000;font-weight:700>)).</span><span style=color:teal>willReturn</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;businessMethod&#34;</span><span style=color:#000;font-weight:700>);</span>
    given<span style=color:#000;font-weight:700>(</span>methodList2<span style=color:#000;font-weight:700>.</span><span style=color:teal>get</span><span style=color:#000;font-weight:700>(</span>15<span style=color:#000;font-weight:700>)).</span><span style=color:teal>willReturn</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;technicalMethod&#34;</span><span style=color:#000;font-weight:700>);</span>

    <span style=color:#998;font-style:italic>// when
</span><span style=color:#998;font-style:italic></span>    stuffToTest<span style=color:#000;font-weight:700>.</span><span style=color:teal>doSomething</span><span style=color:#000;font-weight:700>(</span>15<span style=color:#000;font-weight:700>);</span>

    <span style=color:#998;font-style:italic>// then
</span><span style=color:#998;font-style:italic></span>    <span style=color:#998;font-style:italic>// ne lève pas d&#39;exception
</span><span style=color:#998;font-style:italic></span>  <span style=color:#000;font-weight:700>}</span>

  <span style=color:#3c5d5d;font-weight:700>@Test</span>
  <span style=color:#000;font-weight:700>public</span> <span style=color:#458;font-weight:700>void</span> <span style=color:#900;font-weight:700>shouldCaptArgument</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#998;font-style:italic>// given
</span><span style=color:#998;font-style:italic></span>    <span style=color:#998;font-style:italic>// when
</span><span style=color:#998;font-style:italic></span>    stuffToTest<span style=color:#000;font-weight:700>.</span><span style=color:teal>addBusinessStuff</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;businessMethod&#34;</span><span style=color:#000;font-weight:700>);</span>

    <span style=color:#998;font-style:italic>// then
</span><span style=color:#998;font-style:italic></span>    verify<span style=color:#000;font-weight:700>(</span>methodList<span style=color:#000;font-weight:700>).</span><span style=color:teal>add</span><span style=color:#000;font-weight:700>(</span>methodCaptor<span style=color:#000;font-weight:700>.</span><span style=color:teal>capture</span><span style=color:#000;font-weight:700>());</span>
    assertSame<span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;businessMethod&#34;</span><span style=color:#000;font-weight:700>,</span> methodCaptor<span style=color:#000;font-weight:700>.</span><span style=color:teal>getValue</span><span style=color:#000;font-weight:700>());</span>
  <span style=color:#000;font-weight:700>}</span>

  <span style=color:#3c5d5d;font-weight:700>@Test</span>
  <span style=color:#000;font-weight:700>public</span> <span style=color:#458;font-weight:700>void</span> <span style=color:#900;font-weight:700>shouldSpyMyMap</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#998;font-style:italic>// given
</span><span style=color:#998;font-style:italic></span>    <span style=color:#998;font-style:italic>// when
</span><span style=color:#998;font-style:italic></span>    classInstances<span style=color:#000;font-weight:700>.</span><span style=color:teal>put</span><span style=color:#000;font-weight:700>(</span>String<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>,</span> <span style=color:#d14>&#34;instance&#34;</span><span style=color:#000;font-weight:700>);</span>

    <span style=color:#998;font-style:italic>// then
</span><span style=color:#998;font-style:italic></span>    verify<span style=color:#000;font-weight:700>(</span>classInstances<span style=color:#000;font-weight:700>).</span><span style=color:teal>put</span><span style=color:#000;font-weight:700>(</span>eq<span style=color:#000;font-weight:700>(</span>String<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>),</span> any<span style=color:#000;font-weight:700>(</span>String<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>));</span>
  <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>Pourquoi ces annotations? Eh bien afin de rendre les tests plus clairs. Faire du beau code dans le code de production ne suffit pas, il faut faire attention à la clareté et l&rsquo;expressivité de ces tests. Il ne faut pas oublier qu&rsquo;on écrit seulement une fois du code et qu&rsquo;on le relit bien plus. Parlez à vos équipe de maintenance ou d &lsquo;évolutions combien de temps il passent à comprendre ce que vous avez voulu coder.</p><p>L&rsquo;idée c&rsquo;est d'écrire du code le plus propre possible, mais d&rsquo;avoir aussi les tests les plus propres possibles, ceci aidera à comprendre à votre lecteur quelle(s) responsabilité(s) et quelle(s) comportement(s) son attendu.</p><h2 id=pour-tester-du-code-legacy>Pour tester du code <strong>legacy</strong></h2><p>Ah voilà qui devrait en intéresser plus d&rsquo;un. Pour votre ancien code ou vous devez traverser une grappe d&rsquo;objet pour mocker le dernier, c'était plutôt fastidieux.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>Mockito<span style=color:#000;font-weight:700>.</span><span style=color:teal>when</span><span style=color:#000;font-weight:700>(</span>mockedLegacyCode<span style=color:#000;font-weight:700>.</span><span style=color:teal>getTop</span><span style=color:#000;font-weight:700>()).</span><span style=color:teal>thenReturn</span><span style=color:#000;font-weight:700>(</span>mockedTop<span style=color:#000;font-weight:700>);</span>

Mockito<span style=color:#000;font-weight:700>.</span><span style=color:teal>when</span><span style=color:#000;font-weight:700>(</span>mockedTop<span style=color:#000;font-weight:700>.</span><span style=color:teal>getMiddle</span><span style=color:#000;font-weight:700>()).</span><span style=color:teal>thenReturn</span><span style=color:#000;font-weight:700>(</span>mockedBottomRight<span style=color:#000;font-weight:700>);</span>

Mockito<span style=color:#000;font-weight:700>.</span><span style=color:teal>when</span><span style=color:#000;font-weight:700>(</span>mockedBottomRight<span style=color:#000;font-weight:700>.</span><span style=color:teal>getId</span><span style=color:#000;font-weight:700>()).</span><span style=color:teal>thenReturn</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;BR&#34;</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>Pour information, depuis longtemps déjà Mockito supporte la création de mock avec des réponses prédéfinies. Jusque là par défaut, les mock retournait les valeur par défaut, 0 pour un entier, null pour une référence, etc&mldr; Typiquement on évitais les null avec la réponse, qui renvoyait donc des mocks :</p><p>[java]Mockito.mock(LegacyCode.class, Mockito.RETURNS_MOCKS);[/java]</p><p>Cependant la limite de cette réponse était qu&rsquo;on ne pouvait pas créer des comportements pour des objets profonds dans la grappe d&rsquo;objet. Et c&rsquo;est là que la version 1.8.3 fournit un petit ajout assez sympa, on pourra maintenant écrire des choses comme :</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>CrapyLegacy mock <span style=color:#000;font-weight:700>=</span> Mockito<span style=color:#000;font-weight:700>.</span><span style=color:teal>mock</span><span style=color:#000;font-weight:700>(</span>CrapyLegacy<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>,</span> Mockito<span style=color:#000;font-weight:700>.</span><span style=color:teal>RETURNS_DEEP_STUBS</span><span style=color:#000;font-weight:700>);</span>

Mockito<span style=color:#000;font-weight:700>.</span><span style=color:teal>when</span><span style=color:#000;font-weight:700>(</span>mock<span style=color:#000;font-weight:700>.</span><span style=color:teal>getTop</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>getMiddle</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>getBottomRight</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>getId</span><span style=color:#000;font-weight:700>()).</span><span style=color:teal>thenReturn</span><span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;deep id&#34;</span><span style=color:#000;font-weight:700>);</span>

assertEquals<span style=color:#000;font-weight:700>(</span><span style=color:#d14>&#34;deep id&#34;</span><span style=color:#000;font-weight:700>,</span> mock<span style=color:#000;font-weight:700>.</span><span style=color:teal>getTop</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>getMiddle</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>getBottomRight</span><span style=color:#000;font-weight:700>().</span><span style=color:teal>getId</span><span style=color:#000;font-weight:700>());</span>
</code></pre></div><p>De la même manière avec les annotations étendues, on déclarera le mock de cette façon :</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#3c5d5d;font-weight:700>@Mock</span><span style=color:#000;font-weight:700>(</span>answer <span style=color:#000;font-weight:700>=</span> RETURNS_DEEP_STUBS<span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>private</span> CrapyLegacy mock<span style=color:#000;font-weight:700>;</span>
</code></pre></div><p><strong>Attention cependant</strong>, ceci est une facilité pour tester le code legacy, utiliser cette facilité aujourd&rsquo;hui pour du nouveau est un signe grave que vous êtes en train de développer du code Legacy!</p><blockquote><p>En effet vous jouez avec la loi de Demeter, et quand on joue à la loi de Demeter c&rsquo;est très souvent parce que le code créé n&rsquo;est pas <strong>orienté objet</strong> : il s&rsquo;agit de code procédural! > <em>Le code procédural peut coûter cher voire très cher à maintenir et à faire évoluer</em> [1]. C&rsquo;est un des élément de la dette technique et financière qui coutera plus cher d&rsquo;année en année!</p></blockquote><h2 id=un-mot-sur-le-tdd>Un mot sur le TDD</h2><p>Mockito s&rsquo;enrichit, fournit des facilités, permet d'éclaircir le code, pour véritablement être dans l&rsquo;esprit TDD. L&rsquo;esprit TDD ce n&rsquo;est pas de faire de la couverture de code, ce n&rsquo;est pas d'écrire du code puis de le tester après, ce n&rsquo;est pas de tester la mécanique interne d&rsquo;une classe. C&rsquo;est juste commencer par écrire un test simple pour exprimer une responsabilité et un comportement qu&rsquo;on attend sur un objet, puis d&rsquo;enrichir le code et le test associé.</p><p>Si vous voulez faire du reverse engineering ou essayer des framework inconnus, commencez par écrire un test qui correspond à ce que vous attendez, puis refactorer petit à petit le code testé et le test. Le code s&rsquo;enrichira petit à petit, si ça devient difficile peut-être que voues êtes face à un problème de découpage de responsabilités, ça peut induire de créer de nouveaux objets et donc de spliter le test également. Ce faisant vous réduisez la complexité du code et du test.</p><p>Si vous le nom de vos classes ou de vos méthodes ne sont pas satisfaisant c&rsquo;est que les responsabilités ne sont pas clairement définies/identifiées, un refactoring est à prévoir.</p><p>Au début c&rsquo;est un peu difficile, mais avec un peu d&rsquo;exercice on devient meilleur! N&rsquo;est-ce pas le but de l&rsquo;agilité, de s&rsquo;améliorer!</p><p>Source [1] : <a href="http://www3.interscience.wiley.com/journal/114082374/abstract?CRETRY=1&SRETRY=0">http://www3.interscience.wiley.com/journal/114082374/abstract?CRETRY=1&SRETRY=0</a></p></div><div class="navigation navigation-single"><a href=/2010/02/16/les-collections-par-google-comment-sy-retrouver/ class=navigation-prev><i aria-hidden=true class="fa fa-chevron-left"></i><span class=navigation-tittle>Les collections par Google, comment s'y retrouver?</span></a>
<a href=/2010/03/30/a-propos-du-design-de-vos-objets-des-getters-et-setters-de-equalshashcode-et-de-la-mutabilite/ class=navigation-next><span class=navigation-tittle>A propos du design de vos objets, des getters et setters, de equals/hashCode et de la mutabilité</span>
<i aria-hidden=true class="fa fa-chevron-right"></i></a></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){this.page.identifier='79 http:\/\/dutheil.brice.online.fr\/blog\/?p=79';this.page.title='Mockito 1.8.3';this.page.url='https://blog.arkey.fr/2010/03/09/mockito-1-8-3/';};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"thecoffeeworkshop"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></div><script defer src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js integrity="sha256-KzZiKy0DWYsnwMF+X1DvQngQ2/FxF7MF3Ff72XcpuPs=" crossorigin=anonymous></script><script type=text/javascript>hljs.initHighlightingOnLoad();</script></body></html>