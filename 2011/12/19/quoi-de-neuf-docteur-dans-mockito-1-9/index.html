<!doctype html><html lang=en><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=cache-control content="public"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.69.0"><title>Mockito 1.9.0 is out - Bientôt sur les repos maven • The Coffee Workshop</title><meta name=twitter:card content="summary"><meta name=twitter:title content="Mockito 1.9.0 is out - Bientôt sur les repos maven"><meta name=twitter:description content="EDIT: Hop. Enfin la release 1.9.0 est dispo en téléchargement.
 Après pas mal de travail avec des périodes plus ou moins intenses - bref les vicissitudes du développement Open Source - le projet sort une nouvelle version 1."><meta property="og:title" content="Mockito 1.9.0 is out - Bientôt sur les repos maven"><meta property="og:description" content="EDIT: Hop. Enfin la release 1.9.0 est dispo en téléchargement.
 Après pas mal de travail avec des périodes plus ou moins intenses - bref les vicissitudes du développement Open Source - le projet sort une nouvelle version 1."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.arkey.fr/2011/12/19/quoi-de-neuf-docteur-dans-mockito-1-9/"><meta property="article:published_time" content="2011-12-19T10:37:06+00:00"><meta property="article:modified_time" content="2011-12-19T10:37:06+00:00"><meta property="og:site_name" content="Arkey"><link rel=stylesheet href=/scss/hyde-hyde.9181f25ed2263aeb878ec6f8a84f10c4ebb16150000fca8767308880bdde5ca0.css integrity="sha256-kYHyXtImOuuHjsb4qE8QxOuxYVAAD8qHZzCIgL3eXKA="><link rel=stylesheet href=/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58+TzH3icCkSHGoJ+ed7w=" media=print><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=apple-touch-icon-precomposed sizes=72x72 href=/apple-touch-icon-72-precomposed.png><link rel=apple-touch-icon-precomposed sizes=114x114 href=/apple-touch-icon-114-precomposed.png><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" sizes=192x192 href=/android-192-favicon.png><link rel="shortcut icon" href=/android-192-favicon.png></head><body><div class=sidebar><div class=container><div class=sidebar-about><span class=site__title><a href=https://blog.arkey.fr>The Coffee Workshop</a></span><div class=author-image><img src="https://www.gravatar.com/avatar/f31c7fbcbb0766d0632d96fd7e74b649?s=240&d=mp" class="img--circle img--headshot element--center" alt=gravatar></div><p class=site__description>Java mostly, and general tech</p></div><div class=collapsible-menu><input type=checkbox id=menuToggle>
<label for=menuToggle>The Coffee Workshop</label><div class=menu-content><div><ul class=sidebar-nav><li><a href=/><span class=fa-icon><i class="fas fa-home"></i></span><code>cd <em>~</em></code>
<span></span></a></li><li><a href=/posts/><span class=fa-icon><i class="fas fa-stream"></i></span><code>ls <em>posts/*</em></code>
<span></span></a></li><li><a href=/series/><span class=fa-icon><i class="fas fa-list-alt"></i></span><code>grep -o <em>series</em> posts/* | sort -u</code>
<span></span></a></li><li><a href=/tags/><span class=fa-icon><i class="fas fa-tags"></i></span><code>grep -o <em>tags</em> posts/* | sort -u</code>
<span></span></a></li><li><a href=/cool-stuff/><span class=fa-icon><i class="fas fa-thumbtack"></i></span><code>cd <em>cool-stuff</em></code>
<span></span></a></li><li><a href=/whoami/><span class=fa-icon><i class="fas fa-id-card"></i></span><code>whoami</code>
<span></span></a></li></ul></div><section class=social><a href=https://twitter.com/@BriceDutheil rel=me><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="bird" class="svg-inline--fa fa-bird fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a><a href=https://github.com/bric3 rel=me><i class="fab fa-github fa-lg" aria-hidden=true></i></a><a href=https://speakerdeck.com/bric3 rel=me><i class="fab fa-speaker-deck" aria-hidden=true></i></i></a><a href=https://linkedin.com/in/dutheilbrice rel=me><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="pro-network" class="svg-inline--fa fa-pro-network fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></a><a href=https://stackoverflow.com/users/48136/brice rel=me><i class="fab fa-stack-overflow fa-lg" aria-hidden=true></i></a></section></div></div><div class=copyright>&copy; 2010 - 2020 Brice Dutheil
<a href=https://creativecommons.org/licenses/by-sa/4.0>CC BY-SA 4.0</a></div></div></div><div class="content container"><article><header><h1>Mockito 1.9.0 is out - Bientôt sur les repos maven</h1><div class=post__meta><i class="fas fa-calendar-alt"></i>2011-12-19<br><i class="fas fa-tags"></i><a class="badge badge-tag" href=/tags/code>code</a>
<a class="badge badge-tag" href=/tags/tdd>tdd</a>
<a class="badge badge-tag" href=/tags/constructor-injection>constructor injection</a>
<a class="badge badge-tag" href=/tags/mockito>mockito</a>
<a class="badge badge-tag" href=/tags/tdd>tdd</a><br><i class="fas fa-clock"></i>2 min read</div></header><div class=post><p><strong>EDIT:</strong> Hop. Enfin la release 1.9.0 est dispo en téléchargement.</p><hr><p>Après pas mal de travail avec des périodes plus ou moins intenses - <em>bref les vicissitudes du développement Open Source</em> - le projet sort une nouvelle version <strong>1.9.0</strong> en <del>Release Candidate</del>, avec des bugfixes et bien sûr des nouvelles features. Il y a un <a href="http://code.google.com/p/mockito/downloads/detail?name=mockito-1.9.0.zip">ici</a> et bientôt disponible sur le central maven.</p><ul><li>Pour être plus fluent et expressif, l&rsquo;API introduit les alias <code>then()</code> et <code>will()</code> pour les réponses personnalisées (<code>Answer</code>). Ainsi que d&rsquo;autres petits tweak de l&rsquo;API:</li></ul><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#3c5d5d;font-weight:700>@Test</span>
<span style=color:#000;font-weight:700>public</span> <span style=color:#458;font-weight:700>void</span> <span style=color:#900;font-weight:700>engine_should_only_work_with_diesel</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
    given<span style=color:#000;font-weight:700>(</span>engine<span style=color:#000;font-weight:700>.</span><span style=color:teal>start</span><span style=color:#000;font-weight:700>()).</span><span style=color:teal>will</span><span style=color:#000;font-weight:700>(</span>throwExceptionIfEssenceInsteadOfDiesel<span style=color:#000;font-weight:700>());</span>
    <span style=color:#998;font-style:italic>// ...
</span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>}</span>

<span style=color:#000;font-weight:700>private</span> Answer <span style=color:#900;font-weight:700>throwExceptionIfEssenceInsteadOfDiesel</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000;font-weight:700>return</span> <span style=color:#000;font-weight:700>new</span> Answer<span style=color:#000;font-weight:700>&amp;</span>lt<span style=color:#000;font-weight:700>;</span>EngineStatus<span style=color:#000;font-weight:700>&amp;</span>gt<span style=color:#000;font-weight:700>;()</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>public</span> EngineStatus <span style=color:#900;font-weight:700>answer</span><span style=color:#000;font-weight:700>(</span>InvocationOnMock invocation<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
            <span style=color:#998;font-style:italic>// answer code
</span><span style=color:#998;font-style:italic></span>        <span style=color:#000;font-weight:700>}</span>
    <span style=color:#000;font-weight:700>};</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><ul><li>Les mocks peuvent maintenant être déclaré dans la configuration du stub, sur une ligne.</li></ul><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>DieselEngine de <span style=color:#000;font-weight:700>=</span> given<span style=color:#000;font-weight:700>(</span>mock<span style=color:#000;font-weight:700>(</span>DieselEngine<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>).</span><span style=color:teal>start</span><span style=color:#000;font-weight:700>()).</span><span style=color:teal>willThrow</span><span style=color:#000;font-weight:700>(</span>TankIsEmpty<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>)</span>
                                                         <span style=color:#000;font-weight:700>.</span><span style=color:teal>getMock</span><span style=color:#000;font-weight:700>();</span>
</code></pre></div><ul><li>On peut maintenant renvoyer la classe d&rsquo;une exception plutôt que son instance.</li></ul><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>given<span style=color:#000;font-weight:700>(</span>someMock<span style=color:#000;font-weight:700>).</span><span style=color:teal>willThrow</span><span style=color:#000;font-weight:700>(</span>IllegalArgumentException<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>,</span> SomethingIsWrongException<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><ul><li>Si jamais vous avez besoin de debugguer un bout de code ou les interactions sont non prédictibles, il est maintenant possible de loguer les invocations du mock ou de l&rsquo;espion. Attention, bien qu&rsquo;utile à l&rsquo;occasion avec du code legacy, quand même si jamais ce besoin s&rsquo;en fait sentir sur un nouveau développement c&rsquo;est que ce code devient trop complexe.</li></ul><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>List mockedList <span style=color:#000;font-weight:700>=</span> mock<span style=color:#000;font-weight:700>(</span>List<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>,</span> withSettings<span style=color:#000;font-weight:700>().</span><span style=color:teal>verboseLogging</span><span style=color:#000;font-weight:700>());</span>
mockedList<span style=color:#000;font-weight:700>.</span><span style=color:teal>get</span><span style=color:#000;font-weight:700>(</span>0<span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>On pourra également ajouter des callbacks sur chaque interaction du mock.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>Observer observer <span style=color:#000;font-weight:700>=</span> mock<span style=color:#000;font-weight:700>(</span>Observer<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>,</span>
                        withSettings<span style=color:#000;font-weight:700>().</span><span style=color:teal>invocationListeners</span><span style=color:#000;font-weight:700>(</span>listener1<span style=color:#000;font-weight:700>,</span> listener2<span style=color:#000;font-weight:700>));</span>
willThrow<span style=color:#000;font-weight:700>(</span>IllegalArgumentException<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>).</span><span style=color:teal>given</span><span style=color:#000;font-weight:700>(</span>observer<span style=color:#000;font-weight:700>.</span><span style=color:teal>update</span><span style=color:#000;font-weight:700>(</span>observable<span style=color:#000;font-weight:700>,</span>
                                                                <span style=color:#d14>&#34;what has changed&#34;</span><span style=color:#000;font-weight:700>));</span>
</code></pre></div><ul><li>Pas mal de travail a été fait sur les annotations. Maintenant il n&rsquo;est plus nécéssaire d&rsquo;initialiser un champ annoté par <code>@Spy</code> s&rsquo;il existe dans la classe un constructeur sans argument.</li></ul><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#3c5d5d;font-weight:700>@RunWith</span><span style=color:#000;font-weight:700>(</span>MockitoJUnitRunner<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>SomeTest</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#998;font-style:italic>// pas besoin d&#39;initialiser le champs
</span><span style=color:#998;font-style:italic></span>  <span style=color:#3c5d5d;font-weight:700>@Spy</span> <span style=color:#000;font-weight:700>private</span> ArrayList spiedArrayList<span style=color:#000;font-weight:700>;</span>

  <span style=color:#3c5d5d;font-weight:700>@Test</span> <span style=color:#000;font-weight:700>public</span> <span style=color:#458;font-weight:700>void</span> <span style=color:#900;font-weight:700>verify_some_interactions</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
    spiedArrayList<span style=color:#000;font-weight:700>.</span><span style=color:teal>iterator</span><span style=color:#000;font-weight:700>();</span>
    verify<span style=color:#000;font-weight:700>(</span>spiedArrayList<span style=color:#000;font-weight:700>,</span> once<span style=color:#000;font-weight:700>()).</span><span style=color:teal>iterator</span><span style=color:#000;font-weight:700>();</span>
  <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><ul><li>Et pour la fin mais pas des moindres, le mécanisme d&rsquo;injection de mockito supporte maintenant l&rsquo;injection par constructeur. A l&rsquo;heure actuelle, seul les mocks et spies déclaré dans le test en tant que champs pourront être injecté dans le constructeur du champs annoté par <code>@InjectMocks</code>.</li></ul><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#3c5d5d;font-weight:700>@RunWith</span><span style=color:#000;font-weight:700>(</span>MockitoJUnitRunner<span style=color:#000;font-weight:700>.</span><span style=color:teal>class</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>EngineTest</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#3c5d5d;font-weight:700>@Mock</span> Diesel diesel<span style=color:#000;font-weight:700>;</span>
  <span style=color:#3c5d5d;font-weight:700>@InjectMocks</span> Engine engine<span style=color:#000;font-weight:700>;</span>

  <span style=color:#3c5d5d;font-weight:700>@Test</span> <span style=color:#000;font-weight:700>public</span> <span style=color:#458;font-weight:700>void</span> <span style=color:#900;font-weight:700>engine_should_consume_Diesel</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
    engine<span style=color:#000;font-weight:700>.</span><span style=color:teal>start</span><span style=color:#000;font-weight:700>();</span>
  <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>Ou <code>Engine</code> a un constructeur avec le paramètre Diesel.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>Engine</span> <span style=color:#000;font-weight:700>{</span>
  Diesel diesel<span style=color:#000;font-weight:700>;</span>
  <span style=color:#000;font-weight:700>public</span> <span style=color:#900;font-weight:700>Engine</span><span style=color:#000;font-weight:700>(</span>Diesel diesel<span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:teal>diesel</span> <span style=color:#000;font-weight:700>=</span> diesel<span style=color:#000;font-weight:700>;</span>
  <span style=color:#000;font-weight:700>}</span>

  <span style=color:#000;font-weight:700>public</span> <span style=color:#458;font-weight:700>boolean</span> <span style=color:#900;font-weight:700>start</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
    checkNotEmpty<span style=color:#000;font-weight:700>(</span>diesel<span style=color:#000;font-weight:700>);</span>
    <span style=color:#998;font-style:italic>// ...
</span><span style=color:#998;font-style:italic></span>  <span style=color:#000;font-weight:700>}</span>
  <span style=color:#998;font-style:italic>// ...
</span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>Pour l&rsquo;instant en RC, cette release permettra d&rsquo;adoucir les angles si nous en avons loupé certains éléments. N&rsquo;hésitez pas à nous poser des questions sur la <a href=https://stackoverflow.com/questions/tagged/mockito>stackoverflow</a>.</p></div><div class="navigation navigation-single"><a href=/2011/10/21/quelques-live-template-intellij-pour-mockito/ class=navigation-prev><i aria-hidden=true class="fa fa-chevron-left"></i><span class=navigation-tittle>Quelques Live Template IntelliJ pour Mockito</span></a>
<a href=/2012/03/05/hackergarten-paris-ce-quil-faut-savoir-sur-les-projets/ class=navigation-next><span class=navigation-tittle>Hackergarten Paris - ce qu'il faut savoir sur les projets</span>
<i aria-hidden=true class="fa fa-chevron-right"></i></a></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){this.page.identifier='https://blog.arkey.fr/2011/12/19/quoi-de-neuf-docteur-dans-mockito-1-9/';this.page.title='Mockito 1.9.0 is out - Bientôt sur les repos maven';this.page.url='https://blog.arkey.fr/2011/12/19/quoi-de-neuf-docteur-dans-mockito-1-9/';};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"thecoffeeworkshop"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></div><script defer src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js integrity="sha256-KzZiKy0DWYsnwMF+X1DvQngQ2/FxF7MF3Ff72XcpuPs=" crossorigin=anonymous></script><script type=text/javascript>hljs.initHighlightingOnLoad();</script></body></html>